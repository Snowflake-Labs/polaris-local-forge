# Copyright 2025 Snowflake Inc.
# SPDX-License-Identifier: Apache-2.0

version: "3"

silent: true

tasks:
  create:
    desc: Create the k3d cluster and deploy initial components
    cmds:
      - uv run polaris-local-forge cluster create

  bootstrap-check:
    desc: Wait for bootstrap deployments (RustFS, PostgreSQL) to be ready
    cmds:
      - |
        echo "Waiting for RustFS deployment..."
        kubectl wait --for=condition=available deployment/rustfs -n default --timeout=120s
        echo "Waiting for PostgreSQL deployment..."
        kubectl wait --for=condition=available deployment/postgresql -n polaris --timeout=120s
        echo "Bootstrap deployments ready."

  polaris-check:
    desc: Wait for Polaris deployment to be ready
    cmds:
      - |
        echo "Waiting for Polaris deployment..."
        kubectl wait --for=condition=available deployment/polaris -n polaris --timeout=120s
        echo "Polaris deployment ready."

  delete:
    desc: Delete the k3d cluster
    cmds:
      - uv run polaris-local-forge cluster delete --yes

  status:
    desc: Show cluster status
    cmds:
      - k3d cluster list
