# Copyright 2025 Snowflake Inc.
# SPDX-License-Identifier: Apache-2.0

version: "3"

silent: true

tasks:
  deploy:
    desc: Deploy Polaris to the cluster
    cmds:
      - uv run polaris-local-forge polaris deploy

  check:
    desc: Ensure all Polaris deployments have succeeded
    cmds:
      - |
        echo "Checking Polaris deployment..."
        kubectl wait --for=condition=available deployment/polaris -n polaris --timeout=120s
        echo "Polaris deployment ready."

  purge:
    desc: Purge Polaris data
    cmds:
      - uv run polaris-local-forge polaris purge

  bootstrap:
    desc: Bootstrap Polaris (run after deploy)
    cmds:
      - uv run polaris-local-forge polaris bootstrap

  reset:
    desc: Purge and re-bootstrap Polaris
    cmds:
      - task: purge
      - task: deploy
      - task: check
      - task: bootstrap

  status:
    desc: Show Polaris status
    cmds:
      - kubectl get deployments,pods,services -n polaris
