# Copyright 2025 Snowflake Inc.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
# https://github.com/rustfs/helm
# Chart values reference: https://github.com/rustfs/rustfs/blob/main/helm/rustfs/values.yaml
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: rustfs
  namespace: kube-system
spec:
  repo: https://charts.rustfs.com
  chart: rustfs
  createNamespace: true
  targetNamespace: rustfs
  valuesContent: |-
    # Standalone mode for local development (one pod, one pvc)
    mode:
      standalone:
        enabled: true
      distributed:
        enabled: false
    
    # Single replica for local development
    replicaCount: 1
    
    # Credentials - using simple test credentials for local development
    secret:
      rustfs:
        access_key: admin
        secret_key: password
    
    # Service configuration - NodePort for local k3d access
    # Maps to cluster-config.yaml: 9000:31900 (S3 API), 9001:31901 (Console)
    service:
      type: NodePort
      endpoint:
        port: 9000
        nodePort: 31900
      console:
        port: 9001
        nodePort: 31901
    
    # Disable ingress (using NodePort instead)
    ingress:
      enabled: false
    
    # Storage configuration (uses k3s local-path provisioner)
    storageclass:
      name: local-path
      dataStorageSize: 10Gi
      logStorageSize: 256Mi
    
    # Resource limits for local development
    resources:
      requests:
        memory: 256Mi
        cpu: 100m
      limits:
        memory: 1Gi
        cpu: 500m
